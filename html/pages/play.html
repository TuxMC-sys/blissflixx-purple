<play>
  <div class="row">
    <div class="play-title centre-text">What to Play?</div>
  </div>
  <div class="row">
    <div class="col-md-offset-2 col-md-8">
      <form onsubmit={ submitLink }>
        <div class="right-inner-addon">
          <input oninput={enable_clear_form} id="play-input" class="form-control" type="search" name="f_link" placeholder="Play video link" required="" />
          <button onclick={clear_form} class="clearbtn"><i class="fa fa-close"></i></button>
          <button type="submit" class="searchbtn"><i class="fa fa-play"></i></button>
        </div>
      </form>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 centre-text">
      Enter a URL, Torrent or Magnet Link
    </div>
  </div>
  <div show={ link }>
    <hr />
    <itemlist items={ results }></itemlist>
  </div>

  <script>
    var self = this

    self.on('mount', function() {
      $('#play-input').on('keypress', function(e){
        if (e.keyCode == 13){
          e.preventDefault()
          self.submitLink(e)
        };
      });
      riot.route.exec(function(page, link) {
        if (link) {
          self.enable_clear_form()
          self.f_link.value = decodeURIComponent(link)
          self.getLink()
        }
        else {
          self.clear_form()
        }
        $('#play-input').focus()
      })
    })

    submitLink(e) {
      var link = self.f_link.value
      if (link) {
        Utils.goRoute('play', link) 
      }
    }

    getLink() {
      self.link = self.f_link.value
      self.results = null
      self.update()
      Utils.rpc('playlink', 'item', {link:self.link}, function(err, data) {
        if (err) return Utils.showError(err)
        self.results = data
        self.update()
      })
    }

    enable_clear_form(){
      $(".right-inner-addon .clearbtn").removeClass("invisible")
    }

    clear_form(){
      self.f_link.value = ''
      // hide the clear button (x)
      $(".right-inner-addon .clearbtn").addClass("invisible")
    }
  </script>
</play>
